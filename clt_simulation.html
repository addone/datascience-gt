<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­å¿ƒæ¥µé™å®šç†ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼ˆã‚µã‚¤ã‚³ãƒ­ï¼‰V2.1</title>
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        svg: {
          fontCache: 'global'
        }
      };
    </script>
    <script type="text/javascript" id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
    </script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f7f6;
            color: #333;
        }
        .container {
            max-width: 900px;
            margin: auto;
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #38761d;
            border-bottom: 3px solid #b6d7a8;
            padding-bottom: 10px;
            margin-bottom: 25px;
        }
        h2 {
            color: #3d85c6;
            border-left: 5px solid #3d85c6;
            padding-left: 10px;
            margin-top: 30px;
        }
        p, li {
            line-height: 1.6;
        }
        .simulator {
            background-color: #f7f9fc;
            padding: 20px;
            border-radius: 8px;
            border: 2px dashed #38761d;
        }
        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: flex-end;
        }
        .control-group {
            flex: 1;
            min-width: 150px;
        }
        .controls label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .controls input[type="number"], .controls button {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        .controls button {
            background-color: #38761d;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
            height: 38px;
        }
        .controls button:hover {
            background-color: #274e13;
        }
        #chartArea {
            margin-top: 20px;
            border: 1px solid #ddd;
            background-color: white;
            padding: 10px;
            border-radius: 5px;
        }
        #stats {
            margin-top: 15px;
            background-color: #e6ffe6;
            padding: 10px;
            border-radius: 5px;
        }
        canvas {
            display: block;
        }
        .axis-label-x {
            text-align: center;
            font-weight: bold;
            margin-top: 5px;
        }
        .formula {
            background-color: #fff;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Consolas', 'Courier New', monospace;
            overflow-x: auto;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ² ä¸­å¿ƒæ¥µé™å®šç†ï¼ˆCLTï¼‰ã®å¯è¦–åŒ–</h1>

    <div class="section">
        <h2>ğŸ’¡ ä¸­å¿ƒæ¥µé™å®šç†ã¨ã¯ï¼Ÿ</h2>
        <p>ä¸­å¿ƒæ¥µé™å®šç†ã¨ã¯ã€<strong>ã€Œæ¯é›†å›£ã®åˆ†å¸ƒã®å½¢çŠ¶ã«é–¢ä¿‚ãªãã€ãã“ã‹ã‚‰æ¨™æœ¬ã‚’æŠ½å‡ºã—ã€ãã®æ¨™æœ¬å¹³å‡ã‚’è¨ˆç®—ã™ã‚‹ã¨ã„ã†ä½œæ¥­ã‚’å¤šæ•°å›ç¹°ã‚Šè¿”ã™ã¨ã€ãã®æ¨™æœ¬å¹³å‡ã®åˆ†å¸ƒã¯<a href="https://bellcurve.jp/statistics/course/7797.html" target="_blank">æ­£è¦åˆ†å¸ƒï¼ˆãƒ™ãƒ«å‹ï¼‰</a>ã«è¿‘ã¥ãã€</strong>ã¨ã„ã†çµ±è¨ˆå­¦ã®æ ¹å¹¹ã¨ãªã‚‹å®šç†ã§ã™ã€‚ </p>
        <p>æ­£è¦åˆ†å¸ƒã®ç¢ºç‡å¯†åº¦é–¢æ•°ï¼ˆPDFï¼‰ï¼š</p>
        <div class="formula">$f(x)=\frac{1}{\sqrt{2\pi\sigma^2}}e^{-\frac{(x-\mu)^2}{2\sigma^2}}$</div>
        <p>ã“ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ã‚µã‚¤ã‚³ãƒ­ï¼ˆä¸€æ§˜åˆ†å¸ƒï¼‰ã‚’ä½¿ã£ã¦ã“ã®åŸç†ã‚’ä½“æ„Ÿã—ã¾ã™ã€‚ã‚µã‚¤ã‚³ãƒ­ã®æ¯å¹³å‡ã¯ $\mathbf{3.5}$ ã§ã™ã€‚</p>
    </div>

    <div class="section simulator">
        <h2>ğŸ§ª ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šã¨å®Ÿè¡Œ</h2>
        
        <div class="controls">
            <div class="control-group">
                <label for="sampleSize">1. æ¨™æœ¬ã‚µã‚¤ã‚º $N$ï¼ˆ1å›ã®è©¦è¡Œã§æŒ¯ã‚‹ã‚µã‚¤ã‚³ãƒ­ã®æ•°ï¼‰ï¼š</label>
                <input type="number" id="sampleSize" value="1" min="1" max="50">
            </div>
            <div class="control-group">
                <label for="numTrials">2. è©¦è¡Œå›æ•°ï¼ˆæ¨™æœ¬å¹³å‡ã®è¨ˆç®—å›æ•°ï¼‰ï¼š</label>
                <input type="number" id="numTrials" value="1000" min="100" max="10000">
            </div>
            <button onclick="runSimulation()">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œï¼</button>
        </div>

        <div id="stats">
            <strong>é›†è¨ˆçµæœï¼š</strong>
            <p id="statsOutput">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚</p>
        </div>

        <div id="chartArea">
            <strong>æ¨™æœ¬å¹³å‡ã®åˆ†å¸ƒãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ </strong>
            <canvas id="cltChart" width="800" height="300"></canvas>
            <div class="axis-label-x">æ¨ªè»¸: æ¨™æœ¬å¹³å‡ $\bar{x}$ ã®å€¤ (å‡ºç›®)</div>
        </div>
    </div>
    
    <div class="section">
        <h2>ğŸ” çµæœã®è€ƒå¯Ÿï¼ˆå­¦ç¿’ã®æ·±åŒ–ï¼‰</h2>
        <p>ç‰¹ã«<strong>æ¨™æœ¬ã‚µã‚¤ã‚º $N$ ã®å€¤</strong>ã‚’å¤‰ãˆãªãŒã‚‰ã€ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã®å½¢çŠ¶ã®å¤‰åŒ–ã‚’è¦³å¯Ÿã—ã¾ã—ã‚‡ã†ã€‚</p>
        <ol>
            <li>$N=1$ ã®ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã¯ã€ã™ã¹ã¦ã®å‡ºç›®ãŒã»ã¼åŒã˜é«˜ã•ã«ãªã‚‹**é•·æ–¹å½¢ï¼ˆä¸€æ§˜åˆ†å¸ƒï¼‰**ã«ãªã‚Šã¾ã™ã€‚</li>
            <li>$N=20$ ç¨‹åº¦ã«å¢—ã‚„ã™ã¨ã€ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã¯**æ¯å¹³å‡ 3.5 ã‚’ä¸­å¿ƒã¨ã—ãŸãƒ™ãƒ«å‹**ã«åæŸã—ã¦ã„ãã¾ã™ã€‚</li>
            <li><strong>ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã®å¹…</strong>ãŒã€æ¨™æœ¬ã‚µã‚¤ã‚º $N$ ãŒå¤§ãããªã‚‹ã»ã©ç‹­ã¾ã‚‹ã“ã¨ã‚’ç¢ºèªã—ãªã•ã„ã€‚ã“ã‚Œã¯<strong>æ¨™æº–èª¤å·® ($\sigma / \sqrt{N}$) ãŒå°ã•ããªã‚‹</strong>ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚</li>
        </ol>
        <p>ä¸­å¿ƒæ¥µé™å®šç†ã¯ã€çµ±è¨ˆçš„æ¨æ¸¬ã®åŸºç¤ã‚’æˆã™é‡è¦ãªæ¦‚å¿µã§ã™ã€‚å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿åˆ†æã«ãŠã„ã¦ã‚‚ã€æ¨™æœ¬å¹³å‡ãŒæ­£è¦åˆ†å¸ƒã«è¿‘ã¥ãæ€§è³ªã‚’åˆ©ç”¨ã—ã¦ã€ä¿¡é ¼åŒºé–“ã®è¨­å®šã‚„ä»®èª¬æ¤œå®šãŒè¡Œã‚ã‚Œã¾ã™ã€‚ï¼ˆè§£èª¬è³‡æ–™ï¼š<a href="https://bellcurve.jp/statistics/course/8543.html" target="_blank">[1]</a> <a href="https://bellcurve.jp/statistics/course/8545.html" target="_blank">[2]</a>ï¼‰</p>
    </div>

</div>

<script>
// ä»®æƒ³æ¯é›†å›£ã®è¨­å®š
const MU = 3.5; 
const SIGMA = 1.7078; // æ¯æ¨™æº–åå·® (ã‚µã‚¤ã‚³ãƒ­)

function runSimulation() {
    const N = parseInt(document.getElementById('sampleSize').value);
    const numTrials = parseInt(document.getElementById('numTrials').value);
    
    if (N < 1 || numTrials < 100) {
        alert("è¨­å®šå€¤ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚æ¨™æœ¬ã‚µã‚¤ã‚ºã¯1ä»¥ä¸Šã€è©¦è¡Œå›æ•°ã¯100ä»¥ä¸Šã«è¨­å®šã—ã¦ãã ã•ã„ã€‚");
        return;
    }

    const sampleMeans = [];
    
    for (let i = 0; i < numTrials; i++) {
        let sumOfDice = 0;
        for (let j = 0; j < N; j++) {
            sumOfDice += Math.floor(Math.random() * 6) + 1; // 1ã€œ6
        }
        sampleMeans.push(sumOfDice / N);
    }

    // çµ±è¨ˆé‡ã®è¨ˆç®—
    const meanOfMeans = sampleMeans.reduce((a, b) => a + b, 0) / numTrials;
    const variance = sampleMeans.reduce((a, b) => a + Math.pow(b - meanOfMeans, 2), 0) / numTrials;
    const stdDevOfMeans = Math.sqrt(variance);

    // ç†è«–å€¤ã®è¨ˆç®— (CLTã‚ˆã‚Š)
    const theoreticalStdDev = SIGMA / Math.sqrt(N);

    // çµ±è¨ˆé‡ã®å‡ºåŠ›
    document.getElementById('statsOutput').innerHTML = `
        è©¦è¡Œå›æ•°: ${numTrials} å›, æ¨™æœ¬ã‚µã‚¤ã‚º: N = ${N}<br>
        è¨ˆç®—ã•ã‚ŒãŸæ¨™æœ¬å¹³å‡ã®å¹³å‡: ${meanOfMeans.toFixed(3)} (ç†è«–å€¤: 3.500)<br>
        è¨ˆç®—ã•ã‚ŒãŸæ¨™æœ¬å¹³å‡ã®æ¨™æº–åå·®: ${stdDevOfMeans.toFixed(3)} (ç†è«–å€¤: ${theoreticalStdDev.toFixed(3)})
    `;

    // ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã®æç”»
    drawHistogram(sampleMeans, N, numTrials);
}

function drawHistogram(data, N, numTrials) {
    const canvas = document.getElementById('cltChart');
    const ctx = canvas.getContext('2d');
    const width = canvas.width;
    const height = canvas.height;
    ctx.clearRect(0, 0, width, height);

    const minX = 1.0;
    const maxX = 6.0;
    const numBins = 25; 
    const binWidth = (maxX - minX) / numBins;
    const padding = 50; // è»¸ãƒ©ãƒ™ãƒ«ã®ãŸã‚ã«ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å¢—ã‚„ã™
    const chartWidth = width - 2 * padding;
    const chartHeight = height - 2 * padding;

    // éšç´šã«ãƒ‡ãƒ¼ã‚¿ã‚’æŒ¯ã‚Šåˆ†ã‘ã‚‹
    const counts = new Array(numBins).fill(0);
    let maxCount = 0;

    data.forEach(mean => {
        if (mean >= minX && mean <= maxX) {
            let binIndex = Math.floor((mean - minX) / binWidth);
            if (binIndex === numBins) binIndex = numBins - 1;
            counts[binIndex]++;
            if (counts[binIndex] > maxCount) {
                maxCount = counts[binIndex];
            }
        }
    });

    // Xè»¸ï¼ˆæ¨ªè»¸ï¼‰ã®æç”»
    ctx.strokeStyle = '#333';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(padding, chartHeight + padding);
    ctx.lineTo(width - padding, chartHeight + padding);
    ctx.stroke();

    // Yè»¸ï¼ˆç¸¦è»¸ï¼‰ã®æç”»
    ctx.beginPath();
    ctx.moveTo(padding, padding);
    ctx.lineTo(padding, chartHeight + padding);
    ctx.stroke();

    // ã‚°ãƒ©ãƒ•æç”»ï¼ˆæ£’ã‚°ãƒ©ãƒ•ï¼‰
    ctx.fillStyle = '#6aa84f';
    ctx.strokeStyle = '#38761d';
    ctx.lineWidth = 1;

    for (let i = 0; i < numBins; i++) {
        const barX = padding + i * (chartWidth / numBins);
        const barHeight = (counts[i] / maxCount) * chartHeight * 0.95; 
        const barWidth = chartWidth / numBins;

        ctx.fillRect(barX, chartHeight + padding - barHeight, barWidth - 1, barHeight);
        ctx.strokeRect(barX, chartHeight + padding - barHeight, barWidth - 1, barHeight);
    }
    
    // Yè»¸ãƒ©ãƒ™ãƒ«ï¼ˆç¸¦è»¸ï¼‰
    ctx.save(); // ç¾åœ¨ã®çŠ¶æ…‹ã‚’ä¿å­˜
    ctx.translate(padding / 2, height / 2); // åŸç‚¹ã‚’ç§»å‹•
    ctx.rotate(-Math.PI / 2); // 90åº¦å›è»¢
    ctx.textAlign = 'center';
    ctx.fillStyle = '#333';
    ctx.font = 'bold 12px Arial';
    ctx.fillText("åº¦æ•°ï¼ˆé »åº¦ï¼‰", 0, 0);
    ctx.restore(); // çŠ¶æ…‹ã‚’å…ƒã«æˆ»ã™

    // Yè»¸ç›®ç››ã‚Š
    ctx.font = '10px Arial';
    ctx.fillText(`${maxCount}`, padding - 30, padding + 5);
    ctx.fillText(`0`, padding - 15, chartHeight + padding + 5);


    // æ¯å¹³å‡(3.5)ã®å‚ç›´ç·š (ç†è«–ã®ä¸­å¿ƒ)
    const scaleX = chartWidth / (maxX - minX);
    const muX = padding + (MU - minX) * scaleX;
    ctx.strokeStyle = 'red';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(muX, padding);
    ctx.lineTo(muX, chartHeight + padding);
    ctx.stroke();
    ctx.fillStyle = 'red';
    ctx.font = '12px Arial';
    ctx.fillText("æ¯å¹³å‡ =3.5", muX + 5, padding + 15);

    // Xè»¸ç›®ç››ã‚Šã®æç”»
    ctx.fillStyle = '#333';
    ctx.font = '10px Arial';
    [1.0, 2.0, 3.0, 4.0, 5.0, 6.0].forEach(val => {
        const xPos = padding + (val - minX) * scaleX;
        ctx.fillText(val.toFixed(1), xPos - 10, chartHeight + padding + 15);
    });
}

// åˆå›å®Ÿè¡Œ
window.onload = runSimulation;

</script>

</body>
</html>
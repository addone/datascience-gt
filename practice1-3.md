# 演習ガイド1-3：出生数と婚姻件数の相関分析 💑

## 演習の目的

「人口動態調査」の単一データファイルを用いて、**都道府県別の出生数と婚姻件数**という2つの変数の関係性を分析する。このプロセスを通じて、以下のスキルを習得する。

* データ再利用: 既存のデータセットから必要な変数を抽出し、分析用に再構成する。
* 2変数データの可視化: **散布図**を作成し、2つの変数の関係を視覚的に捉える。
* 相関分析: **相関係数の計算プロセス（偏差、共分散、標準偏差）**をステップ・バイ・ステップで理解し、関係の強さと向きを定量的に評価する。
* 統計的思考: 「相関関係は因果関係を意味しない」という、データ分析における重要な原則を理解する。

---

## ステップ1：分析用データの準備

1.  前回の「1変数分析（ヒストグラム作成）」で使用したExcelファイル（`人口動態分析.xlsx`など）を開きます。
2.  「+」ボタンで**新しいシートを追加**し、シート名を「**出生数と婚姻件数**」などに変更します。
3.  **元のデータシート**（CSVからインポートしたシート）に戻り、47都道府県の「**都道府県**」、「**出生数**」、「**婚姻件数**」の3列をコピーし、新しいシートの`A1`セルに貼り付けます。

---

## ステップ2：散布図（Scatter Plot）による関係の可視化

1.  「出生数」（B列）と「婚姻件数」（C列）の2つの数値データ範囲（見出しも含む）を選択します。
2.  `挿入`タブ > `散布図` を選択します。
3.  グラフタイトルや軸ラベルを整え、データ点を右クリックして「**近似曲線の追加**」を行います。

参考資料：[*近似曲線*とは？](https://qiita.com/Sakai_path/items/8040beeb6c857665b604)


---

## ステップ3：相関係数の計算プロセスを理解する

次は、散布図で見た関係性を、相関係数で計算します。

まず、相関係数（ピアソンの積率相関係数 r）の計算式を確認します：

$r = \frac{\sum_{i=1}^{n}(x_i - \bar{x})(y_i - \bar{y})}{\sqrt{\sum_{i=1}^{n}(x_i - \bar{x})^2}\sqrt{\sum_{i=1}^{n}(y_i - \bar{y})^2}}$

複雑な数式ですが、その意味は分子*2つのデータが一緒に動く度合い（共分散）* を、分母*それぞれのデータが持つ「ばらつき」の大きさ* で割り算（正規化）することです。
​
高度な関数を使わずに、Excelの基本操作だけで計算してみましょう。これにより、相関係数がどのように成り立っているかが分かります。

（作業列として、D列以降を使っていきます。データがB2〜C48セルにあると仮定します）

### (1) 平均値を求める
まず、計算の基準となる各変数の平均値を求めます。
* 空いているセル（例: `F1`）に「出生数平均」、`G1`セルに「婚姻件数平均」と入力します。
* `F2`セルに: `=AVERAGE(B2:B48)`
* `G2`セルに: `=AVERAGE(C2:C48)`

### (2) 「偏差」を計算する
「偏差」とは、各データが平均値からどれだけ離れているかを示す値です。
* `D1`セルに「出生数_偏差」、`E1`セルに「婚姻件数_偏差」と入力します。
* `D2`セルに: `=B2-$F$2`
    * （`F2`の部分はキーボードのF4キーを押して `$F$2` と**絶対参照**にすると便利です）
* `E2`セルに: `=C2-$G$2`
    * （`G2`の部分も `$G$2` と**絶対参照**にします）
* `D2`セルと`E2`セルを選択し、フィルハンドル（右下の■）をダブルクリックして、47都道府県分の偏差を計算します。

### (3) 偏差の「積」と「二乗」を計算する
相関係数の構成要素である「共分散」と「標準偏差」の元を計算します。
* `H1`セルに「偏差の積」、`I1`セルに「出生数_偏差の二乗」、`J1`セルに「婚姻件数_偏差の二乗」と入力します。
* `H2`セルに: `=D2*E2`
* `I2`セルに: `=D2*D2` (または `=D2^2`)
* `J2`セルに: `=E2*E2` (または `=E2^2`)
* `H2`〜`J2`セルを選択し、フィルハンドルで下までコピーします（フィルハンドルをダブルクリックしても良い）。

### (4) 共分散と標準偏差を計算する
各列の合計値を使い、共分散と標準偏差を計算します。(データ数 n=47 です)
* 空いているセル（例: `L1`）に「**共分散**」と入力し、`M1`セルに以下を入力します。
    * `=SUM(H2:H48)/47`
* `L2`セルに「**出生数 標準偏差**」と入力し、`M2`セルに以下を入力します。
    * `=SQRT(SUM(I2:I48)/47)`
* `L3`セルに「**婚姻件数 標準偏差**」と入力し、`M3`セルに以下を入力します。
    * `=SQRT(SUM(J2:J48)/47)`

### (5) 相関係数を計算する
相関係数は、「共分散」を「2つの標準偏差の積」で割ったものです。
* `L5`セルに「**相関係数**」と入力し、`M5`セルに以下を入力します。
    * `=M1/(M2*M3)`

これで相関係数が計算できました。

---

## ステップ4：相関係数を理解する

相関係数を「計算」しましたが、その数値の「解釈」はもっと重要です。

詳細については、**[相関係数（r）が何を意味しているのか？](https://addone.github.io/datascience-gt/correlation_simulator)** へ進んでください。
（Excelの関数でとても簡単なやり方もぜひチェックしてください。）

---

## ステップ5：考察 - 関係性の解釈

作成した散布図と計算した相関係数から、日本の人口動態について考察しましょう。

1.  **関係の向きと強さ**:
    * **問**: 散布図の点の分布と近似曲線は、どのような傾向を示していますか？計算した**相関係数**は、その傾向をどのように数値で裏付けていますか？
    * **ヒント**: 近似曲線は右上がりですか、右下がりですか？相関係数の値は+1、-1、0のうちどれに近いですか？これらの結果から、「婚姻件数が多い都道府県ほど、出生数も多い傾向にある」と言えるか考えてみましょう。

2.  **外れ値の特定**:
    * **問**: 散布図の右上（婚姻件数も出生数も特に多い）に位置する点は、どの都道府県でしょうか？これらの大都市圏が、全体の相関関係にどのような影響を与えているか考えてみてください。
    * **ヒント**: グラフの右上にある点をクリックすると、どの行のデータかを確認できます。もしこれらの大都市がなかった場合、相関関係はもっと強くなるでしょうか、それとも弱くなるでしょうか？

3.  **相関と因果の罠【最重要】**:
    * **問**: 「婚姻件数が多いほど出生数も多い」という強い相関関係が見られました。この結果から、私たちは「婚姻件数を増やせば（原因）、出生数も増える（結果）」と結論付けても良いのでしょうか？
    * **ヒント**: 「婚姻件数」と「出生数」の両方を同時に増やしている、**見えない別の要因（第三の変数）**は存在しないでしょうか？例えば「**人口**」という要因を考えてみてください。人口が多い都道府県は、当然、婚姻する人の数も子どもが生まれる数も多くなるのではないでしょうか。このように、相関関係は必ずしも直接的な原因と結果の関係を示すものではありません。この原則は、データ分析を行う上で最も注意すべき点の一つです。

---

## ステップ6：演習ファイルの提出

演習お疲れ様でした。最後に、完成したExcelファイルを提出してください。

### 提出するファイル

* 前回から作業しているExcelファイル（`.xlsx`形式）
* ファイル名は「**学籍番号-氏名-データ科学演習1.xlsx**」のように、自分が誰だかわかる名前に変更してください。

### ファイルに含めるべきシート

提出前に、ファイルに必要なシートがすべて含まれているか確認してください。

1.  **「元のデータ」シート**
    * e-Statからインポートした、CSVの生データがそのまま残っているシート。
2.  **「出生数分布」シート**
    * 「出生数」の基礎統計量（平均、中央値、標準偏差など）の計算表。
    * 「出生数」の度数分布表とヒストグラム（棒の間隔が0%になっていること）。
3.  **「出生数と婚姻件数」シート**
    * 「出生数」と「婚姻件数」の相関分析用データ。
    * 「出生数」と「婚姻件数」の散布図（近似曲線が追加されていること）。
    * 相関係数の手計算プロセス（偏差、偏差の積、共分散、標準偏差）と、最終的な相関係数の計算結果。

**【最終確認】**
すべてのシートが正しく保存されていることを確認したら、ファイルを閉じ、Teamsの課題へ添付して課題を提出してください。

---

## おまけ 💡

今回の演習、本当にお疲れ様でした。e-Statから実データを取得し、その「生の姿」を可視化する一連の流れを体験してもらいました。平均値だけでは見えない「分布の歪み」や「ばらつきの大きさ」に、多くの発見があったと思います。

さて、皆さんの学びをここで終わらせず、ぜひ未来に繋げてほしいと願っています。特に、観光学を専攻する皆さんにとって、最強の武器となるデータが日本には存在します。

それが、**観光庁が公開している「[インバウンド消費動向調査/訪日外国人消費動向調査](https://www.mlit.go.jp/kankocho/tokei_hakusyo/gaikokujinshohidoko.html)」**です。

### なぜ、このデータが「宝の山」なのか？

皆さんがこれから向き合う「インバウンド観光」の課題は、もはや勘や経験、度胸（K.K.D.）だけで解決できる時代ではありません。データに基づいた戦略こそが、次の時代を創ります。

「インバウンド消費動向調査」は、まさにそのための**「訪日客の生の声」**が詰まったデータセットです。

このデータを分析することで、皆さんは以下のような問いに、具体的な数字で答えを出せるようになります。

- 国籍・地域別で、彼らは何に一番お金を使っているのか？ （「爆買い」は本当か？「食」への支出か？それとも「体験（コト消費）」か？）
- どの地域を訪れ、どのくらいの期間滞在しているのか？ （ゴールデンルート以外の地方には、本当に行っていないのか？）
- 日本を訪れる前に、どこで情報を得ているのか？ （SNSか？旅行代理店か？友人か？プロモーション戦略のヒント）
- 旅行中に困ったことは何か？満足した点は何か？ （多言語対応？Wi-Fi環境？交通の便？具体的な改善点）

### あなたの「強み」とデータを掛け合わせる

忘れないでほしいのは、皆さんがただのデータアナリストではない、ということです。

皆さんは**「観光学」と「語学」**という専門知識を持っており、この強みとデータ分析スキルが組み合わさったとき、他の誰にも真似できない価値が生まれます。

- 統計データが示す「満足度」の背景にある文化的な違いを推測できる。
- データが示す「支出額」が、どの観光資源（アニメ、自然、食文化）と結びついているかを深く考察できる。

データは、皆さんの専門知識を裏付け、より説得力のある戦略を立てるための羅針盤となります。

### データを「味方」につけよう

今回学んだExcelの基礎統計量やヒストグラムの作成は、その第一歩です。次のステップとして、ぜひ観光庁のWebサイトを訪れ、報告書や公開データを眺めてみてください。

そこには、皆さんが卒業後に観光業界で直面するであろう、リアルな課題と、それを解くためのヒントが詰まっています。

データは、決して難しい数学だけの世界ではありません。それは、**観光客の行動や心理を理解するための「新しい言語」**です。皆さんの持つ言語能力と観光への情熱に、この新しい言語を加えて、未来の観光社会をリードする人材になることを心から期待しています。

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èª²é¡Œï¼šäº¬é‡èœã‚«ãƒ¼ãƒ‰ã¨å¹¾ä½•åˆ†å¸ƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f4f7f9;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .main-container {
            width: 100%;
            max-width: 750px;
        }
        .assignment-box, .explanation-box {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px 30px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        .assignment-box h2, .explanation-box h2 {
            color: #d35400;
            text-align: center;
            margin-top: 0;
        }
        .assignment-box h3, .explanation-box h3 {
            color: #2c3e50;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 5px;
        }
        .assignment-box ol { padding-left: 20px; }
        .assignment-box li { margin-bottom: 10px; }

        .simulator-container {
            width: 100%;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            padding: 25px 30px;
            text-align: center;
            margin-bottom: 25px;
        }
        .settings { margin-bottom: 20px; }
        .settings label {
            font-weight: bold;
            font-size: 1.1em;
            margin-right: 10px;
        }
        .settings input {
            width: 80px;
            padding: 8px;
            font-size: 1.1em;
            text-align: center;
            border: 2px solid #bdc3c7;
            border-radius: 5px;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 25px 0;
        }
        .controls button {
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            background-color: #e67e22;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: bold;
        }
        .controls button.secondary { background-color: #2c3e50; }
        .controls button:hover { opacity: 0.85; }

        .status-display {
            padding: 15px;
            border-radius: 8px;
            background: #fdf3e6;
            min-height: 120px;
        }
        .coupon-grid {
            display: grid;
            gap: 5px;
            margin-bottom: 15px;
        }
        .coupon {
            width: 100%;
            padding-bottom: 100%;
            position: relative;
            border-radius: 5px;
            background-color: #bdc3c7;
        }
        .coupon.collected { background-color: #2ecc71; }
        .coupon.target { background-color: #e74c3c; animation: pulse 1.5s infinite; }
        .coupon span {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: white; font-weight: bold;
            font-size: 0.8rem;
        }
        #simulation-log {
            font-size: 1.2em;
            font-weight: bold;
            color: #34495e;
            height: 50px;
        }
        .results {
            margin-top: 20px;
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
        }
        #avg-trials {
            color: #c0392b;
            font-size: 2em;
            font-weight: bold;
        }
        .chart-container {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 2px solid #ecf0f1;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); }
            100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
        }
    </style>
</head>
<body>
<div class="main-container">

    <div class="assignment-box">
        <h2>èª²é¡Œï¼šäº¬é‡èœã‚«ãƒ¼ãƒ‰ã¨ã€Œã‚ã¨1æšã®å£ã€</h2>
        <h3>çŠ¶æ³è¨­å®š</h3>
        <p>
            äº¬éƒ½ã®é£Ÿå“ä¼šç¤¾ãŒã€æ–°ã—ã„ã‚¹ãƒŠãƒƒã‚¯è“å­ã‚’ç™ºå£²ã—ã¾ã—ãŸã€‚ãŠã¾ã‘ã¨ã—ã¦ã€è³€èŒ‚ãªã™ã€è–è­·é™¢ã ã„ã“ã‚“ã€ä¹æ¡ã­ãã¨ã„ã£ãŸ**äº¬é‡èœ**ã®ã‚«ãƒ¼ãƒ‰ãŒ1æšå…¥ã£ã¦ã„ã¾ã™ã€‚
            
            ã‚ãªãŸã¯ç†±å¿ƒã«ã‚«ãƒ¼ãƒ‰ã‚’é›†ã‚ã€ã‚‚ã†å°‘ã—ã§ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆã§ã™ï¼
        </p>
        
        <h3>å•é¡Œ</h3>
        <ol>
            <li>
                <strong>ç›´æ„Ÿã¨æ¤œè¨¼</strong><br>
                ã‚«ãƒ¼ãƒ‰ã®ç·ç¨®é¡æ•°ã‚’ **10** ã«è¨­å®šã—ã¦ãã ã•ã„ã€‚ã‚ãªãŸãŒæ—¢ã«9ç¨®é¡ã‚’é›†ã‚ã¦ã„ã‚‹ã¨ãã€æœ€å¾Œã®1æšã‚’å¼•ãã®ã«å¿…è¦ãªå¹³å‡è³¼å…¥å›æ•°ã¯ä½•å›ã ã¨æ€ã„ã¾ã™ã‹ï¼Ÿç›´æ„Ÿã§äºˆæƒ³ã—ã¦ã‹ã‚‰ã€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã§ç¢ºã‹ã‚ã¦ãã ã•ã„ã€‚
            </li>
            <li>
                <strong>åˆ†å¸ƒã®è¦³å¯Ÿ</strong><br>
                ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¹°ã‚Šè¿”ã™ã¨ã€ä¸‹ã«**ç¢ºç‡åˆ†å¸ƒã‚°ãƒ©ãƒ•**ãŒæã‹ã‚Œã¾ã™ã€‚é’ã„æ£’ã‚°ãƒ©ãƒ•ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœï¼‰ãŒã€ã‚ªãƒ¬ãƒ³ã‚¸ã®ç·šã‚°ãƒ©ãƒ•ï¼ˆç†è«–å€¤ï¼‰ã«å¾ã€…ã«è¿‘ã¥ã„ã¦ã„ãã“ã¨ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚
            </li>
            <li>
                <strong>è€ƒå¯Ÿ (ç™ºå±•)</strong><br>
                ã‚«ãƒ¼ãƒ‰ã®ç·ç¨®é¡æ•°ã‚’ **5** ã‚„ **20** ã«å¤‰ãˆã‚‹ã¨ã€ã‚°ãƒ©ãƒ•ã®å½¢ï¼ˆç‰¹ã«ã‚ªãƒ¬ãƒ³ã‚¸ã®ç·šã®å‚¾ãï¼‰ã¯ã©ã†å¤‰ã‚ã‚‹ã§ã—ã‚‡ã†ã‹ï¼Ÿãã®å½¢ãŒæ„å‘³ã™ã‚‹ã“ã¨ï¼ˆå‡ºã‚„ã™ã•ã€å‡ºã«ãã•ï¼‰ã‚’è€ƒå¯Ÿã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
            </li>
        </ol>
    </div>

    <div class="simulator-container">
        <h2>ãƒ©ã‚¹ãƒˆãƒ¯ãƒ³ãƒ»ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>
        <div class="settings">
            <label for="total-types">ã‚«ãƒ¼ãƒ‰ã®ç·ç¨®é¡æ•°:</label>
            <input type="number" id="total-types" value="10" min="2" max="50">
        </div>
        <div class="status-display">
            <div id="coupon-grid" class="coupon-grid"></div>
            <div id="simulation-log">è¨­å®šã‚’ç¢ºèªã—ã€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã—ã¦ãã ã•ã„</div>
        </div>
        <div class="controls">
            <button onclick="runSingleLastOneSim()">ã‚ã¨1æšã‚’å¼•ãã¾ã§è©¦è¡Œ</button>
            <button class="secondary" onclick="runMonteCarloLastOne(100)">100ã‚»ãƒƒãƒˆè©¦è¡Œ</button>
        </div>
        <div class="results">
            <h3>çµ±è¨ˆçµæœ</h3>
            <p>å¹³å‡è©¦è¡Œå›æ•°: <span id="avg-trials">0.00</span></p>
            <p>ç·ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚»ãƒƒãƒˆæ•°: <span id="total-simulations">0</span></p>
            <button onclick="reset()">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
        <div class="chart-container">
            <h3>ç¢ºç‡åˆ†å¸ƒã‚°ãƒ©ãƒ•</h3>
            <canvas id="distributionChart"></canvas>
        </div>
    </div>
    
    <div class="explanation-box">
        <h2>ã“ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å­¦ã¶ã€Œå¹¾ä½•åˆ†å¸ƒã€ã¨ã¯ï¼Ÿ</h2>
        <p>
            ä»Šå›ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€çµ±è¨ˆå­¦ã§ã€Œ<strong>å¹¾ä½•åˆ†å¸ƒ (Geometric Distribution)</strong>ã€ã¨å‘¼ã°ã‚Œã‚‹ç¢ºç‡åˆ†å¸ƒã‚’æ‰±ã£ã¦ã„ã¾ã™ã€‚
        </p>
        <h3>ã‚­ãƒ¼ã‚¢ã‚¤ãƒ‡ã‚£ã‚¢ ğŸ’¡</h3>
        <p>
            å¹¾ä½•åˆ†å¸ƒã¯ã€ã€Œã‚³ã‚¤ãƒ³ãƒˆã‚¹ã§åˆã‚ã¦è¡¨ãŒå‡ºã‚‹ã¾ã§ã«ä½•å›ã‹ã‹ã‚‹ã‹ï¼Ÿã€ã®ã‚ˆã†ã«ã€<strong>æˆåŠŸã™ã‚‹ã¾ã§ä½•ã‹ã‚’ç¹°ã‚Šè¿”ã—è©¦è¡Œã—ãŸã¨ãã€æˆåŠŸã™ã‚‹ã¾ã§ã®å›æ•°ãŒå¾“ã†ç¢ºç‡åˆ†å¸ƒ</strong>ã§ã™ã€‚<br>
            ä»Šå›ã®èª²é¡Œã§ã¯ã€ã€ŒæˆåŠŸ = æœ€å¾Œã®1æšã®ã‚«ãƒ¼ãƒ‰ã‚’å¼•ãã“ã¨ã€ã«ç›¸å½“ã—ã¾ã™ã€‚
        </p>
        <h3>ã‚°ãƒ©ãƒ•ã®å½¢ãŒæ„å‘³ã™ã‚‹ã“ã¨ ğŸ“ˆ</h3>
        <p>
            ã‚°ãƒ©ãƒ•ã‚’è¦‹ã‚‹ã¨ã€è©¦è¡Œå›æ•°ã€Œ1å›ã€ã®ç¢ºç‡ãŒæœ€ã‚‚é«˜ãã€å›æ•°ãŒå¢—ãˆã‚‹ã«ã¤ã‚Œã¦ç¢ºç‡ãŒä¸‹ãŒã£ã¦ã„ãï¼ˆè£¾ã®é•·ã„ï¼‰å½¢ã‚’ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€
        </p>
        <ul>
            <li><strong>æœ€ã‚‚èµ·ã“ã‚Šã‚„ã™ã„ã®ã¯ã€ã™ãã«æˆåŠŸã™ã‚‹ï¼ˆ1å›ç›®ã§å‡ºã‚‹ï¼‰ã“ã¨ã€‚</strong></li>
            <li><strong>ã—ã‹ã—ã€é‹ãŒæ‚ªã„ã¨éå¸¸ã«å¤šãã®å›æ•°ãŒã‹ã‹ã£ã¦ã—ã¾ã†ï¼ˆè£¾ãŒé•·ã„ï¼‰å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚</strong></li>
        </ul>
        <p>
            ã¨ã„ã†ã“ã¨ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚ã‚ãªãŸã®ç›´æ„Ÿï¼ˆå¹³å‡10å›ã®ã¯ãšï¼‰ã¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœï¼ˆå¹³å‡10å›ï¼‰ãŒä¸€è‡´ã—ãŸã®ã¯ã€ã“ã®åˆ†å¸ƒã®æŒã¤ã€Œè£¾ã®é•·ã•ï¼ˆç¨€ã«ã‚‚ã®ã™ã”ãå›æ•°ãŒã‹ã‹ã‚‹ã‚±ãƒ¼ã‚¹ï¼‰ã€ãŒå¹³å‡å€¤ã‚’æŠ¼ã—ä¸Šã’ã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚
            ã‚°ãƒ©ãƒ•ã®ã‚ªãƒ¬ãƒ³ã‚¸è‰²ã®ç·šãŒå¹¾ä½•åˆ†å¸ƒã®ç†è«–å€¤ã§ã‚ã‚Šã€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¹°ã‚Šè¿”ã™ã»ã©ã€çµæœãŒç†è«–ã«è¿‘ã¥ã„ã¦ã„ãã®ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚
        </p>
        <a href="https://bellcurve.jp/statistics/course/6988.html" target="_blank">æœ¬æ°—è§£èª¬</a>
    </div>
    <div>
        <p>author: G. Li, 2025</p>
    </div>

</div>

<script>
    let allTrialResults = [];
    let distributionChart;

    document.addEventListener('DOMContentLoaded', reset);
    document.getElementById('total-types').addEventListener('change', reset);

    function runSingleLastOneSim() {
        const TOTAL_TYPES = parseInt(document.getElementById('total-types').value);
        const { trials, history } = getLastOne(TOTAL_TYPES);
        
        allTrialResults.push(trials);
        updateAll();

        const log = document.getElementById('simulation-log');
        let i = 0;
        log.textContent = '';
        const interval = setInterval(() => {
            if (i < history.length - 1) {
                log.textContent = `...${history[i]}ã¯ãƒ€ãƒ–ã‚Š...`;
            } else {
                log.textContent = `ğŸ‰ ${trials}å›ç›®ã§ No.${history[i]} ã‚’ã‚²ãƒƒãƒˆï¼`;
                clearInterval(interval);
            }
            i++;
        }, 300);
    }

    function runMonteCarloLastOne(times) {
        const TOTAL_TYPES = parseInt(document.getElementById('total-types').value);
        for (let i = 0; i < times; i++) {
            const { trials } = getLastOne(TOTAL_TYPES);
            allTrialResults.push(trials);
        }
        updateAll();
        document.getElementById('simulation-log').textContent = `${times}å›ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¾ã—ãŸã€‚`;
    }
    
    function getLastOne(totalTypes) {
        const TARGET_COUPON = totalTypes;
        let trials = 0;
        let history = [];
        while (true) {
            trials++;
            const drawnCoupon = Math.floor(Math.random() * totalTypes) + 1;
            history.push(drawnCoupon);
            if (drawnCoupon === TARGET_COUPON) break;
        }
        return { trials, history };
    }

    function updateAll() {
        updateStats();
        updateChart();
    }

    function updateStats() {
        if (allTrialResults.length === 0) return;
        const totalSum = allTrialResults.reduce((sum, val) => sum + val, 0);
        const average = (totalSum / allTrialResults.length).toFixed(2);
        document.getElementById('avg-trials').textContent = average;
        document.getElementById('total-simulations').textContent = allTrialResults.length;
    }
    
    function drawCoupons(total) {
        const grid = document.getElementById('coupon-grid');
        grid.innerHTML = '';
        const columns = Math.min(total, 10);
        grid.style.gridTemplateColumns = `repeat(${columns}, 1fr)`;
        for (let i = 1; i <= total; i++) {
            const couponDiv = document.createElement('div');
            const span = document.createElement('span');
            couponDiv.classList.add('coupon');
            span.textContent = i;
            if (i < total) {
                couponDiv.classList.add('collected');
            } else {
                couponDiv.classList.add('target');
            }
            couponDiv.appendChild(span);
            grid.appendChild(couponDiv);
        }
    }

    function initializeChart() {
        const ctx = document.getElementById('distributionChart').getContext('2d');
        if (distributionChart) {
            distributionChart.destroy();
        }
        distributionChart = new Chart(ctx, {
            type: 'bar',
            data: { labels: [], datasets: [] },
            options: {
                responsive: true,
                scales: {
                    y: { beginAtZero: true, title: { display: true, text: 'åº¦æ•° / ç†è«–ä¸Šã®åº¦æ•°' } },
                    x: { title: { display: true, text: 'æˆåŠŸã¾ã§ã®è©¦è¡Œå›æ•° (k)' } }
                }
            }
        });
    }

    function updateChart() {
        if (!allTrialResults.length) return;
        const totalTypes = parseInt(document.getElementById('total-types').value);
        const p = 1 / totalTypes;

        const frequencies = {};
        allTrialResults.forEach(trial => {
            frequencies[trial] = (frequencies[trial] || 0) + 1;
        });

        const maxTrial = Math.max(20, ...Object.keys(frequencies).map(Number));
        const labels = Array.from({ length: maxTrial }, (_, i) => i + 1);
        const simData = labels.map(label => frequencies[label] || 0);

        const theoreticalData = labels.map(k => Math.pow(1 - p, k - 1) * p * allTrialResults.length);

        distributionChart.data.labels = labels;
        distributionChart.data.datasets = [{
            label: 'ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœ (åº¦æ•°)',
            data: simData,
            backgroundColor: 'rgba(54, 162, 235, 0.6)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
        }, {
            label: `ç†è«–å€¤ (å¹¾ä½•åˆ†å¸ƒ p=1/${totalTypes})`,
            data: theoreticalData,
            type: 'line',
            borderColor: 'rgba(255, 159, 64, 1)',
            backgroundColor: 'rgba(255, 159, 64, 0.2)',
            fill: false,
            tension: 0.1
        }];
        distributionChart.update();
    }

    function reset() {
        allTrialResults = [];
        const totalTypes = parseInt(document.getElementById('total-types').value) || 10;
        
        document.getElementById('avg-trials').textContent = '0.00';
        document.getElementById('total-simulations').textContent = '0';
        document.getElementById('simulation-log').textContent = 'ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹';
        
        drawCoupons(totalTypes);
        initializeChart();
    }
</script>
</body>
</html>